<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Form Penilaian</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <style>
    body { font-family: Arial; background: #eef2f7; }
    .container { max-width: 420px; margin: 80px auto; padding: 30px; background: white; border-radius: 12px; box-shadow: 0 0 12px rgba(0,0,0,0.1); }
    h2 { text-align: center; margin-bottom: 20px; }
    input, button, select, textarea { width: 100%; padding: 10px; margin-top: 10px; border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box; }
    button { background: #4a69bd; color: white; font-weight: bold; }
    button:hover { background: #3b55a0; cursor: pointer; }
    .hidden { display: none; }
    label { margin-top: 10px; display: block; font-weight: bold; }
    #status { margin-top: 15px; font-weight: bold; color: green; text-align: center; }
  </style>
</head>
<body>

<div class="container hidden" id="formContainer">
  <h2>Form Penilaian Siswa</h2>
  <form id="penilaianForm">
    <label for="nis">NIS:</label>
    <select name="nis" id="nisDropdown" required>
      <option value="">-- Pilih NIS --</option>
    </select>

    <label for="mapel">Mata Pelajaran:</label>
    <select name="mapel" required>
      <option value="B. Indonesia">B. Indonesia</option>
      <option value="Matematika">Matematika</option>
      <option value="Produktif">Produktif</option>
    </select>

    <label for="jenis">Jenis Penilaian:</label>
    <select name="jenis" required>
      <option value="UH">UH</option>
      <option value="UTS">UTS</option>
      <option value="UAS">UAS</option>
      <option value="Praktik">Praktik</option>
    </select>

    <label for="nilai">Nilai:</label>
    <input type="number" name="nilai" min="0" max="100" required>

    <label for="catatan">Catatan:</label>
    <textarea name="catatan" rows="3"></textarea>

    <button type="submit">Kirim</button>
    <p id="status"></p>
  </form>
</div>

<script>
const proxyURL = "https://cors-anywhere.herokuapp.com/";
const scriptURL = "https://script.google.com/macros/s/AKfycbzlWnbSZbbQvVK_FQ8U_q4EBYX4On8dILVN6OE5bwu_o5dEMGrU6MvTeYO022BDuFO_ew/exec";

// LOAD NIS
fetch(`${proxyURL}${scriptURL}?action=getNIS`)
  .then(res => res.json())
  .then(data => {
    const dropdown = document.getElementById("nisDropdown");
    data.forEach(siswa => {
      const option = document.createElement("option");
      option.value = siswa.nis;
      option.textContent = `${siswa.nis} - ${siswa.nama}`;
      dropdown.appendChild(option);
    });
    document.getElementById("formContainer").classList.remove("hidden");
  })
  .catch(err => {
    console.error("Error saat memuat NIS:", err);
    document.getElementById("nisDropdown").innerHTML = `<option value="">Gagal memuat NIS</option>`;
  });

// KIRIM PENILAIAN
document.getElementById("penilaianForm").addEventListener("submit", function(e) {
  e.preventDefault();
  const data = Object.fromEntries(new FormData(this).entries());

  fetch(proxyURL + scriptURL, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(data)
  })
  .then(res => res.json())
  .then(result => {
    if (result.status === "success") {
      document.getElementById("status").textContent = "✅ Data berhasil dikirim!";
      e.target.reset();
    } else {
      document.getElementById("status").textContent = "❌ Error: " + result.message;
    }
  })
  .catch(err => {
    console.error("Error kirim data:", err);
    document.getElementById("status").textContent = "❌ Gagal mengirim data.";
  });
});
</script>

</body>
</html>


